# E题题解

## 1.题意：

有三个杯子，最初的时候有一个戒指在中间的杯子，其后n 纳秒，每一纳秒都会等概率的交换左边和中间或者右边和中间，问n纳秒后戒指在中间杯子的概率

## 2.题解：

1.闭式解推导：考虑$dp[n]$表示第n纳秒戒指在中间的概率，则前一纳秒戒指必然不在中间，而是等概率的在左边或右边的杯子里，故有递推式$dp[n]=\frac{1-dp[n-1]}{2}$，化简一下可得$\frac{dp[n]-\frac{1}{3}}{dp[n-1]-\frac{1}{3}}=-\frac{1}{2},dp[1]=0$，递推式累乘得$\frac{dp[n]-\frac{1}{3}}{dp[1]-\frac{1}{3}}=(\frac{-1}{2})^{n-1}$，$dp[n]=-\frac{1}{3}(\frac{-1}{2})^{n-1}+\frac{1}{3}=\frac{2^{n-1}-(-1)^{n-1}}{3(2)^{n-1}}=\frac{2^{n-1}+(-1)^{n}}{3(2)^{n-1}}$

2.分子分母优化：考虑$a_n=\frac{2^{n-1}-(-1)^{n-1}}{3},b_n=2^{n-1},a_n=\frac{1}{3}(2-(-1))(2^{n-1}+(-1)2^{n-2}+\cdots+(-1)^{n-2}2+{-1}^{n-1})=(2^{n-1}+(-1)2^{n-2}+\cdots+(-1)^{n-2}2+{-1}^{n-1})$

可以发现$a_n$一定是整数，因此令分子为$a_n$，分母为$b_n$，这道题理论推导就结束了

3.读入：由于读入数据是乘积形式，且数据量十分巨大，需要进行优化，我们注意到模数$m=1000000007$是一个质数，$\phi(m)=m-1$，由拓展欧拉定理，当$m$是**质数**时

$a^b(mod \ m)\equiv\begin{cases}a^{b\ mod\ m-1},m\nmid b\\ a^{m-1},m\mid b\end{cases}$，在读入时不断对$\phi(m)$取模即可（结束时判断b是否为0）